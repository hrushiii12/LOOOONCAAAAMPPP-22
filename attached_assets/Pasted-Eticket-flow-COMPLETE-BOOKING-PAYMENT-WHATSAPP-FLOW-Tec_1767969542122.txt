Eticket flow .  

---

# âœ… COMPLETE BOOKING + PAYMENT + WHATSAPP FLOW

## ðŸ— Tech stack required

* Frontend â†’ React
* Backend â†’ Node.js (Express)
* Database â†’ PostgreSQL
* Payment â†’ Paytm All-in-One
* Messaging â†’ WhatsApp Cloud API (Meta)
* Ticket storage â†’ database with auto-expiring links

---

# ðŸ” OVERALL BOOKING STATES

Each booking moves like this:

```
PAYMENT_PENDING
PAYMENT_SUCCESS
BOOKING_REQUEST_SENT_TO_OWNER
OWNER_CONFIRMED or OWNER_CANCELLED
TICKET_GENERATED or REFUND_REQUIRED
```

---

# ðŸŸ¢ STEP 1 â€” USER FILLS BOOKING FORM

Form fields:

* Guest Name
* Guest Mobile Number (WhatsApp enabled)
* Property ID
* Property Name
* Check-In date & time
* Check-Out date & time
* Number of guests
* Advance amount payable

On submit â†’ user goes to **payment page (Paytm demo or real)**

---

# ðŸŸ¢ STEP 2 â€” CUSTOMER MAKES PAYMENT

Paytm returns:

* âœ” success
* âŒ failed
* â­• pending

On **payment success only**:

### Database entry created in PostgreSQL

Store:

* booking_id (auto unique)
* property_id
* guest_name
* guest_phone
* owner_phone
* admin_phone
* checkin
* checkout
* advance_paid
* status = `"PAYMENT_SUCCESS"`

---

# ðŸŸ¢ STEP 3 â€” SEND INITIAL WHATSAPP MESSAGE TO CUSTOMER

Immediately after payment success:

Message to **Customer WhatsApp**

> â€œYour advance payment is successful. We are processing your booking now.
> You will receive your e-ticket within 60 minutes after property owner confirms availability.â€

Status becomes:

```
BOOKING_REQUEST_SENT_TO_OWNER
```

---

# ðŸŸ¢ STEP 4 â€” SEND BOOKING REQUEST TO PROPERTY OWNER

WhatsApp template includes:

* Property name
* Guest name
* Dates
* Guests count
* Advance amount
* Buttons:

  * âœ… Confirm booking
  * âŒ Cancel booking

---

# ðŸŸ¢ STEP 5 â€” SEND BOOKING REQUEST TO ADMIN

Admin receives:

* Property name
* Property owner name & number
* Guest name & number
* Status â†’ **Waiting for owner confirmation**

---

# ðŸŸ¢ STEP 6 â€” OWNER RESPONDS VIA WHATSApp BUTTON

Backend receives webhook:

```
OWNER_CONFIRMED
or
OWNER_CANCELLED
```

---

## ðŸŸ¢ CASE A â€” OWNER CONFIRMS BOOKING

System does:

1. Generate **unique e-ticket link**

Example:

```
https://looncamp.shop/eticket/BOOKING12345
```

Ticket contains:

* Property name (big)
* Booking ID
* Guest name
* Check-in & check-out
* Advance paid (small text)
* Due amount (big text)
* Host name: LoonCamp.shop
* Host mobile
* Map location link
* Paytm transaction reference if available

Ticket expiry rule:

```
auto expire after checkout date
```

2. WhatsApp message to **Customer**

> Booking confirmed ðŸŽ‰
> Here is your e-ticket link
> [ticket link]

3. WhatsApp to **Admin**

> Booking confirmed
> property + owner + customer details
> ticket link

4. Update status:

```
OWNER_CONFIRMED
TICKET_GENERATED
```

---

## ðŸ”´ CASE B â€” OWNER CANCELS BOOKING

System does:

1. Send WhatsApp to **Customer**

> Booking cancelled âŒ
> Reason: slot unavailable / fully booked
> Advance payment will be refunded.

2. Send WhatsApp to **Admin**

> Booking cancelled by owner
> Contact customer for refund assistance

3. **No ticket generated**

4. Update status:

```
OWNER_CANCELLED
REFUND_REQUIRED
```

---

# ðŸ’° WhatsApp Cloud API costing per booking

Messages per booking:

1. Payment success â†’ customer
2. Booking request â†’ owner
3. Booking request info â†’ admin
4. Owner confirmation/cancellation â†’ customer
5. Owner confirmation/cancellation â†’ admin

Approx 5 message templates per booking.

Meta India pricing:
âž¡ about â‚¹0.12 per template message
âž¡ Estimated total â‰ˆ **â‚¹0.60 per booking**


---